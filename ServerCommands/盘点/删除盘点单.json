{"Enabled":true,"Triggers":[{"$type":"Forguncy.ServerCommands.Models.PostRequestTrigger, ServerDesignerCommon","Permission":{"AllowRoles":["仓库主管","库存管理员"]},"Parameters":[{"Name":"盘点单号"}]}],"Commands":[{"$type":"Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon","CommandList":[{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"盘点单是否结束","TableValue":{"TableName":"盘点表","OnlyGetValue":true,"TableValueType":0,"BindingInfos":[{"BindingInfo":{"TableName":"盘点表","ColumnName":"是否结束"},"ColumnName":"是否结束"}],"SqlCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"盘点表","ColumnName":"单号"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单号"},"Id":"e1c230a6-15ec-4bc1-9f00-0d2a2e233e69"}},"ID":"45b9a14e25cf4599930220412c6ce47c"},{"$type":"Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon","TableName":"盘点表","UpdateType":"delete","ShowConfirm":true,"ConfirmText":"您确定要删除吗？","RowsToUpdate":1,"RowsToUpdateCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"盘点表","ColumnName":"单号"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单号"},"Id":"c057a519-0ffd-4c55-92ea-4bf8a829e860"},"UpdateValues":[],"ParamNameToSaveNewRowValue":"NewRow"},{"$type":"Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon","TableName":"盘点详情表","UpdateType":"delete","ShowConfirm":true,"ConfirmText":"您确定要删除吗？","RowsToUpdate":1,"RowsToUpdateCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"盘点详情表","ColumnName":"ID"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单号"},"Id":"61a5a43b-af85-47dd-9399-c0577c311085"},"UpdateValues":[],"ParamNameToSaveNewRowValue":"NewRow"},{"$type":"Forguncy.Model.ConditionCommand, ServerDesignerCommon","ConditionAndCommandPairList":[{"Condition":{"$type":"Forguncy.Model.IfCondition, ServerDesignerCommon","param":{"$type":"Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon","ParamObject":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单是否结束"}},"value":"1","Id":"49956e30-4665-4915-b4bb-fab2ff55ef30"},"CommandList":[{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"入库单","TableValue":{"TableName":"出入库表","BindingInfos":[{"BindingInfo":{"TableName":"出入库表","ColumnName":"ID"},"ColumnName":"ID"}],"SqlCondition":{"$type":"ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess","Condition1":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"其他出入库对象"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单号"},"Id":"a0bf4c32-6efd-4852-8256-b84133746435"},"Condition2":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"类型"},"Value":"8","Id":"168be878-c847-4147-908e-8557c20d585e"},"Id":"221524c0-b7a5-4e57-999e-d67f0fb00ab2"}},"ID":"172d53f6b13e425c8a4ae52dae85b446","Comments":"类型为8代表盘点入库"},{"$type":"Forguncy.Model.LoopCommand, ServerDesignerCommon","LoopInfo":{"$type":"Forguncy.Model.CountLoopInfo, ServerDesignerCommon","LoopCount":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=入库单"},"LoopItemParamName":"Item"},"CommandList":[{"$type":"Forguncy.Model.RequestServerCommand, ServerDesignerCommon","ServerCommandName":"删除出入库单","Parameters":[{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=Item.ID"},"ParamName":"出入库单ID"}],"CheckDataValidation":true}],"Comments":"如果存在入库单，则删除"},{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"出库单","TableValue":{"TableName":"出入库表","BindingInfos":[{"BindingInfo":{"TableName":"出入库表","ColumnName":"ID"},"ColumnName":"ID"}],"SqlCondition":{"$type":"ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess","Condition1":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"其他出入库对象"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=盘点单号"},"Id":"c64fa9cc-0952-473a-9329-c1859a673214"},"Condition2":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"类型"},"Value":"7","Id":"d54b8f53-5d21-4d57-ad77-8414dc2595c4"},"Id":"b60d32b5-78cc-4a72-a87c-5fafcc35425c"}},"ID":"677d39402c9c4c8d8a8f0d2701919a1c","Comments":"类型为7代表盘点出库"},{"$type":"Forguncy.Model.LoopCommand, ServerDesignerCommon","LoopInfo":{"$type":"Forguncy.Model.CountLoopInfo, ServerDesignerCommon","LoopCount":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出库单"},"LoopItemParamName":"Item"},"CommandList":[{"$type":"Forguncy.Model.RequestServerCommand, ServerDesignerCommon","ServerCommandName":"删除出入库单","Parameters":[{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=Item.ID"},"ParamName":"出入库单ID"}],"CheckDataValidation":true}],"Comments":"如果存在出库单，则删除"}],"Comments":"如果删除的是结束盘点的盘点单，那么可能需要删除自动生成的出入库单","ID":"fecd95de-1ce9-4216-91fc-2191321eec71"}]}]}],"Name":"删除盘点单"}