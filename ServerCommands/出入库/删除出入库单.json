{"Enabled":true,"Triggers":[{"$type":"Forguncy.ServerCommands.Models.PostRequestTrigger, ServerDesignerCommon","Permission":{"AllowRoles":["仓库主管","库存管理员","采购员","销售员"]},"Parameters":[{"Name":"出入库单ID"}]}],"Commands":[{"$type":"Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon","CommandList":[{"$type":"Forguncy.Model.RequestServerCommand, ServerDesignerCommon","ServerCommandName":"检查是否盘点中","CheckDataValidation":true},{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"出入库订单","TableValue":{"TableName":"出入库表","TableValueType":1,"BindingInfos":[{"BindingInfo":{"TableName":"出入库表","ColumnName":"其他出入库对象"},"ColumnName":"其他出入库对象"},{"BindingInfo":{"TableName":"出入库表","ColumnName":"类型"},"ColumnName":"类型"},{"BindingInfo":{"TableName":"出入库表","ColumnName":"出入库"},"ColumnName":"出入库"}],"SqlCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"ID"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库单ID"},"Id":"cac2907c-8adb-4d6e-90a9-1b27f66d1bdc"}},"ID":"6061ff3e5853493b9b73c84546cc33ea"},{"$type":"Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon","TableName":"出入库表","UpdateType":"delete","ShowConfirm":true,"ConfirmText":"您确定要删除吗？","RowsToUpdate":1,"RowsToUpdateCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库表","ColumnName":"ID"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库单ID"},"Id":"063f8525-631a-4c73-81ab-e9948ee100d8"},"UpdateValues":[],"ParamNameToSaveNewRowValue":"NewRow","Comments":"删除出入库单"},{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"出入库详情","TableValue":{"TableName":"出入库详情表","BindingInfos":[{"BindingInfo":{"TableName":"出入库详情表","ColumnName":"ID"},"ColumnName":"ID"},{"BindingInfo":{"TableName":"出入库详情表","ColumnName":"物品ID"},"ColumnName":"物品ID"},{"BindingInfo":{"TableName":"出入库详情表","ColumnName":"数量"},"ColumnName":"数量"}],"SqlCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库详情表","ColumnName":"出入库ID"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库单ID"},"Id":"414d164b-1f5e-408a-85b1-a93413e4f5ca"}},"ID":"828e7ea0a2604cc7bcd2e0e38bcb468d"},{"$type":"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon","ParameterName":"出入库反操作","ParameterValue":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=IF(出入库订单.出入库=5,6,5)"},"ID":"c4a9eec591cb4421b3dbc3b9da4edc27","Comments":"如果原本为入库，反操作就是出库；如果原本为出库，反操作就是入库。用于恢复物品库存。"},{"$type":"Forguncy.Model.LoopCommand, ServerDesignerCommon","LoopInfo":{"$type":"Forguncy.Model.CountLoopInfo, ServerDesignerCommon","LoopCount":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库详情"},"LoopItemParamName":"物品详情"},"CommandList":[{"$type":"Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon","TableName":"出入库详情表","UpdateType":"delete","ShowConfirm":true,"ConfirmText":"您确定要删除吗？","RowsToUpdate":1,"RowsToUpdateCondition":{"$type":"ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess","ColumnBindingInfo":{"TableName":"出入库详情表","ColumnName":"ID"},"Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=物品详情.ID"},"Id":"29628903-310a-41ad-b4a5-b177a63b256a"},"UpdateValues":[],"ParamNameToSaveNewRowValue":"NewRow"},{"$type":"Forguncy.Model.RequestServerCommand, ServerDesignerCommon","ServerCommandName":"修改物品库存","Parameters":[{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=物品详情.物品ID"},"ParamName":"物品ID"},{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=物品详情.数量"},"ParamName":"变更数"},{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库反操作"},"ParamName":"出入库"}],"CheckDataValidation":true}],"Comments":"删除出入库详情，并更新物品库存"},{"$type":"Forguncy.Model.RequestServerCommand, ServerDesignerCommon","ServerCommandName":"根据出入库单修改 采购单_已入库 销售单_已出库","Parameters":[{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库订单.其他出入库对象"},"ParamName":"采购销售单号"},{"$type":"Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon","Value":{"$type":"Forguncy.Model.FormulaReferObject, ServerDesignerCommon","SerializeProperty":"=出入库订单.类型"},"ParamName":"出入库类型"}],"CheckDataValidation":true}]}],"Name":"删除出入库单"}